<p><h1>Basics</h1></p>

<p><h2>Roles</h2>
   <pre>
  <p>
  There are basically 2 different roles important for you, using this API:</p>

<ul>
<li><strong>Anonymous User:</strong> The credentials for an anonymous user are provided by Upstream Mobility in advance. Your App will stay authenticated using these
credentials until the user uses their own credentials.</li>
<li><strong>Registered User:</strong> A manually registered account, by one of your App's users, based on the user's credentials.</li>
</ul>

<p>The Anonymous User is considered the least priviledged authenticated consumer of the API. It can consume APIs providing basic information,
  like <a href="#operation/search">Locations</a> or <a href="#operation/getOffers">Ticket Offers</a>. For customer-specific resources you need to be authenticated as a
  Registered User. The same applies to all Offer-related topics. I.e. if you want to buy a ticket, you need to be authenticated as a Registered User.</p>

<p>More special roles are required for CRM-related APIs ("Customer-Relationship-Management"), i.e. for back office applications:</p>

<ul>
<li><strong>Agent:</strong> An agent can call APIs which deliver information about any registered user. This role is relevant for a back office employee.</li>
<li><strong>Admin:</strong> An admin is able to manage agents, e.g. create a new agent account. This role is relevant for a back office manager.</li>
</ul>

<p>For almost every API endpoint, some form of Authentication is required. Every documented API lists the applicable Security Schemes and Roles.</p>

<p>Whenever you try to access an API endpoint with a not privileged role, a HttpStatus 403 Error Response is returned
  </p>
   </pre></p>

<p><h1>Error Responses
</h1>
  <pre>
  <p>
  If something goes wrong, you will receive a uniform Error Response.
  </p>
  </pre></p>

<p><h2>Error Format
  </h2>
  <pre>
  <p>
  <code>
  {
      &amp;quot;httpStatusCode&amp;quot;: 404, //required, contains the HTTP status code
      &amp;quot;server&amp;quot;: { //required, contains information about the specific server that sent the response
          &amp;quot;time&amp;quot;: '2019-05-28T14:07:17Z' //required, contains the current server time (UTC)
      },
      &amp;quot;error&amp;quot;: { //required, contains a description of the error
          &amp;quot;code&amp;quot;: &amp;quot;NOT_FOUND&amp;quot;, //required, specific error code
          &amp;quot;message&amp;quot;: &amp;quot;The requested resource couldn't be found&amp;quot; //required, human readable description, useful for debugging, NOT to be used for display purposes
      },
      &amp;quot;fields&amp;quot;: [ //optional, a list of field validation errors for POST and PUT requests with a Request Body
          {
              &amp;quot;name&amp;quot;: &amp;quot;firstName&amp;quot;, //required, the field name of the Request Body
              &amp;quot;error&amp;quot;: { //required, same as above
                  &amp;quot;code&amp;quot;: &amp;quot;MISSING&amp;quot;,
                  &amp;quot;message&amp;quot;: &amp;quot;field is required, but missing&amp;quot;
              }
          }
      ]
  }
  </code></p>

<p>For Legacy reasons, at some API endpoints it is necessary to send a custom <code>Accept</code> Header to receive this error response format. The endpoints in
  question mention the possibility of the custom <code>Accept</code> Header explicitly. If the custom <code>Accept</code> Header is not set and something goes wrong, the
  response will contain the Legacy error format. Since we don't recommend using the Legacy error format, we won't document it here.</p>

<p></p>
  </pre></p>

<p><h2>Error Codes
</h2>
  <pre>
  <p>
  General Client errors (HTTP Status 4xx):</p>

<ul>
<li><code>BAD_REQUEST</code> The request is malformed or required properties are missing (HTTP Status 400)</li>
<li><code>VALIDATION_ERROR</code> An error occurred validating the request body (HTTP Status 400)</li>
<li><code>UNAUTHORIZED</code> Authentication information is missing (HTTP Status 401)</li>
<li><code>TOKEN_EXPIRED</code> Authentication token is expired (HTTP Status 401)</li>
<li><code>AUTHENTICATION_FAILED</code> The given Authentication information is invalid (HTTP Status 401)</li>
<li><code>FORBIDDEN</code> The user privileges are insufficient (HTTP Status 403)</li>
<li><code>TOO_MANY_FAILED_LOGINS</code> Login &amp; other password related features are temporarily blocked because of too many failed login attempts (HTTP Status 403)</li>
<li><code>NOT_FOUND</code> A resource could not be found (HTTP Status 404)</li>
<li><code>CONFLICT</code> Unable to perform the operation because of a conflict (HTTP Status 409)</li>
<li><code>MISSING_REQUIREMENTS</code> Unable to comply due to missing requirements (HTTP Status 409)</li>
<li><code>USER_LOCKED</code> The Account of the User has been locked f.e. by a CRM User (HTTP Status 401)</li>
</ul>

<p>Payment-related Client errors (HTTP Status 4xx)</p>

<ul>
<li><code>NOT_VALID</code> The requested payment provider is invalid (HTTP Status 400)</li>
<li><code>VALIDATION_ERROR</code> An error occurred validating the billing agreement token (HTTP Status 409)</li>
<li><code>PSP_ERROR_REJECTED</code> The payment has been rejected by LogPay (HTTP Status 409)</li>
<li><code>PSP_ACCOUNT_ERROR</code> The customer is blocked at LogPay (HTTP Status 409)</li>
</ul>

<p>Drivers-licence-related Client errors (HTTP Status 4xx)</p>

<ul>
<li><code>DRIVERS_LICENCE_ALREADY_KNOWN</code> The drivers licence with this licence number is already known (HTTP Status 409)</li>
</ul>

<p>Order-related Client errors (HTTP Status 4xx)</p>

<ul>
<li><code>NOT_VALID</code> The requested order contained an invalid combination of parameters (HTTP Status 400)</li>
<li><code>AREA_NOT_VALID</code> The requested order is not applicable to the given area parameter (HTTP Status 409)</li>
<li><code>ORDER_FORBIDDEN</code> The customer is not allowed to order (HTTP Status 403)</li>
</ul>

<p>Ticket-related Client errors (HTTP Status 4xx)</p>

<ul>
<li><code>TICKET_NOT_AVAILABLE</code> The ticket is not yet available for download (HTTP Status 403)</li>
<li><code>TICKET_EXPIRED</code> The ticket is not available for download because the ticket validity is expired (HTTP Status 403)</li>
<li><code>REQUEST_ALREADY_RECEIVED</code> The same ticket order request has been received more than once (HTTP Status 409)</li>
</ul>

<p>Shuttle-related Client errors (HTTP Status 4xx)</p>

<ul>
<li><code>MSP_CANCEL_REJECTED</code> Cancellation is not allowed at this point. (HTTP Status 400)</li>
<li><code>MSP_TRIP_TO_CANCEL_NOT_FOUND</code> The trip to cancel wasn't found. (HTTP Status 400)</li>
<li><code>MSP_CUSTOMER_NOT_ACTIVATED</code> The customer is not activated. (HTTP Status 400)</li>
<li><code>MSP_TRIP_ACTIVE</code> A trip is already active for the given customer. (HTTP Status 400)</li>
<li><code>MSP_TRIP_ALREADY_COMPLETED</code> A trip with the same id was previously completed. (HTTP Status 400)</li>
<li><code>MSP_OFFER_FAILED_BEFORE</code> The offer has failed before and cannot be ordered anymore. (HTTP Status 400)</li>
<li><code>MSP_OFFER_EXPIRED</code> The offer has expired. (HTTP Status 400)</li>
<li><code>MSP_NOT_WITHIN_SERVICE_HOURS</code> The requested ride time is not within the service hours. (HTTP Status 400)</li>
<li><code>MSP_NOT_WITHIN_SEATS_RANGE</code> Requested seats configuration canâ€™t be served. (HTTP Status 400)</li>
<li><code>MSP_NOT_WITHIN_SERVICE_AREA</code> The requested location is not inside a known service area. (HTTP Status 400)</li>
<li><code>MSP_SAME_PICKUP_AND_DELIVERY_STOP</code> Only non-identical stops for pickup and delivery fit request. (HTTP Status 400)</li>
<li><code>MSP_NO_PICKUP_STOPS_NEAR</code> No pickup stop found near the requested location. (HTTP Status 400)</li>
<li><code>MSP_NO_DELIVERY_STOPS_NEAR</code> No delivery stop found near the requested location. (HTTP Status 400)</li>
<li><code>MSP_NO_PICKUP_AND_DELIVERY_STOPS_NEAR</code> No pickup stop and no delivery stop found near requested locations. (HTTP Status 400)</li>
<li><code>MSP_WALKING_LIMIT_EXCEEDED</code> The combined distance to pickup and from delivery stop is too long. (HTTP Status 400)</li>
<li><code>MSP_DIRECT_WALK_IS_FASTER</code> The combined walking distance to pickup and from delivery stop is longer than the distance of the trip. (HTTP Status
400)</li>
<li><code>MSP_DISPATCHING_ERROR</code> We failed to find a vehicle to fulfil the offer or order request. (HTTP Status 400)</li>
<li><code>MSP_ALREADY_ORDERED</code> The offer has already been ordered. (HTTP Status 409)</li>
</ul>

<p>Rental-related Client errors (HTTP Status 4xx)</p>

<ul>
<li><code>FREE_RESERVATIONS_LIMIT_EXCEEDED</code> Customer did too many reservations in a short amount of time. (HTTP Status 400)</li>
<li><code>PRICE_NOT_FOUND</code> MSP could not find given priceId in their system. Perhaps old priceId? (HTTP Status 400)</li>
<li><code>VEHICLE_NOT_AVAILABLE</code> Vehicle is currently not available. (HTTP Status 400)</li>
<li><code>CUSTOMER_NOT_ACTIVATED_AT_MSP</code> The customer is not yet activated for MSP. (HTTP Status 400)</li>
<li><code>ERROR_UNLOCKING_VEHICLE</code> Could not unlock vehicle, because of an error. (HTTP Status 400)</li>
<li><code>IGNITION_STILL_ON</code> Could not end rental, because the ignition is still on. (HTTP Status 400)</li>
<li><code>RENTAL_ALREADY_ENDED</code> Given rental has already ended. (HTTP Status 400)</li>
<li><code>TOO_FAR_AWAY</code> Too far away. We currently don't know what that means. (HTTP Status 400)</li>
<li><code>VEHICLE_NOT_WITHIN_DISTANCE</code> The vehicle is not within user distance. (HTTP Status 400)</li>
<li><code>VEHICLE_IN_FORBIDDEN_AREA</code> Vehicle is in forbidden area. (HTTP Status 400)</li>
<li><code>VEHICLE_OUTSIDE_START_CITY</code> Vehicle is outside of start city. (HTTP Status 400)</li>
<li><code>VEHICLE_NOT_IN_ASSIGNED_REGION_ZONE</code> Vehicle is not in assigned region zone. (HTTP Status 400)</li>
<li><code>ERROR_LOCKING_VEHICLE</code> Could not lock vehicle, because of an error. (HTTP Status 400)</li>
<li><code>PIN_WRONG</code> The given PIN is not correct. (HTTP Status 400)</li>
<li><code>ALREADY_ACTIVE_RENTAL</code> Customer has an already active rent, so could not start a second one. (HTTP Status 409)</li>
<li><code>INVALID_PHASE</code> The operation is not allowed in this rental phase. (HTTP Status 409)</li>
<li><code>ADDITIONAL_FEE_NOT_VALID</code> The given additional fee and the real additional fee do not match. (HTTP Status 409)</li>
</ul>

<p>Specific Client errors (HTTP Status 4xx)</p>

<ul>
<li><code>USER_ALREADY_ACTIVATED</code> A new activation email is requested, but the user account has already been activated (HTTP Status 400)</li>
<li><code>USER_EXISTS</code> A registration attempt is made with an already registered email address (HTTP Status 409)</li>
<li><code>CUSTOMER_USAGE_BLOCKED</code> A registration attempt is made with for a blocked customer for this MSP (HTTP Status 403)</li>
</ul>

<p>Field Validation errors (HTTP Status 4xx)</p>

<ul>
<li><code>NotNull</code> Value is required but null or missing (HTTP Status 400)</li>
<li><code>Size</code> Value violates the size restrictions (HTTP Status 400)</li>
<li><code>NotBlank</code> Value may not be empty, but is null, missing or contains spaces only (HTTP Status 400)</li>
<li><code>Email</code> Value must be a valid email address, but could not be validated (HTTP Status 400)</li>
<li><code>Pattern</code> Value does not match an expected pattern (HTTP Status 400)</li>
<li><code>Past</code> Date value is expected to be in the past, but is the present or in the future (HTTP Status 400)</li>
<li><code>AssertTrue</code> Boolean value is expected to be true (HTTP Status 400)</li>
<li><code>Type</code> The given value is not of the expected type, e.g. Enum or Date (HTTP Status 400)</li>
<li><code>Min</code> Numerical value is below an expected minimum (HTTP Status 400)</li>
<li><code>Max</code> Numerical value is above an expected minimum (HTTP Status 400)</li>
<li><code>RemainingTries</code> Additional information about a failed login attempt, containing the number of remaining login tries in the "message" property (HTTP
Status 401)</li>
<li><code>PinInvalid</code> The delivered PIN is not correct (HTTP Status 400)</li>
<li><code>Duplicate</code> The delivered value is already present (HTTP Status 400)</li>
<li><code>PriceInvalid</code> The price somehow has changed / was corrupted and the offer is not valid anymore (HTTP Status 400)</li>
<li><code>TokenInvalid</code> The provided token is no valid billing agreement token (HTTP Status 409)</li>
</ul>

<p>General Server errors (HTTP Status 5xx):</p>

<ul>
<li><code>SERVER_ERROR</code> An internal server error occurred (HTTP Status 500)</li>
<li><code>MSP_NOT_SUPPORTED</code> MSP is not supported. (HTTP Status 501)</li>
<li>Other non-documented error codes are possible in this case for debugging purposes. It is not required to parse and interpret the code for HTTP
Status 5xx.</li>
</ul>

<p>Shuttle-related Server errors (HTTP Status 5xx)</p>

<ul>
<li><code>MSP_GENERAL_ERROR</code> An internal, technical error occurred. (HTTP Status 500)</li>
</ul>

<p>Rental-related Server errors (HTTP Status 5xx)</p>

<ul>
<li><code>GENERAL_ERROR</code> An internal error has occurred (HTTP Status 500)</li>
<li><code>UNKNOWN_MSP_ERROR</code> MSP sent an unknown error with errorCode 'UNICORN_ERROR' and message 'A unicorn blocks your car.' (HTTP Status 500)</li>
<li><code>RENTAL_IS_IN_UNEXPECTED_STATE</code> Expected was STARTING or STARTED (HTTP Status 500)</li>
<li><code>AUTHENTICATION_FAILED_AT_MSP</code> Could not authenticate against MSP. (HTTP Status 500)</li>
<li><code>SUSPICIOUS_CUSTOMER_ACTIVITY_AT_MSP</code> MSP temporarily blocked the customer, because they have detected some suspicious activity on his/her account,
e.g. suspicious drivers licence number. (HTTP Status 500)</li>
<li><code>PRICE_NOT_VALID</code> The given price is not correct. (HTTP Status 500)</li>
<li><code>ORDER_CUSTOMER_NUMBER_NOT_MATCHING</code> The requested rental order does not belong to the user. (HTTP Status 500)</li>
</ul>

<p></p>
  </pre></p>

<p><h1>Date Format
</h1>
  <pre>
  <p>
  Our APIs sometimes expect dates as input in the request body or returns dates in the response body. In this case, we rely on string representation of
  the date according to <a href="https://en.wikipedia.org/wiki/ISO_8601">ISO 8601</a>.</p>

<p>Dates contained in the response body will always be in UTC timezone (zero offset), unless specified otherwise. You may, however, use any other
  timezone in requests, as long as the offset is specified correctly.</p>

<p>For better understanding of how the string representation of a date might look like, please take a look
  at <a href="https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#ISO_OFFSET_DATE_TIME">the Java documentation of ISO_OFFSET_DATE_TIME</a>.</p>
  </pre></p>
